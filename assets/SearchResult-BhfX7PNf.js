import{p as j,f as se,q as te,t as I,v as le,x as ae,y as ie,z as re,A as L,g as w,B as ue,w as N,C as t,D as oe,R as O,E as ne,F as ce,G as ve,H as he,I as me,J as pe,j as de,K as ye,L as ge,M as A,N as fe,O as Ee,P as He,Q as T,S as G,T as ke}from"./app-4CVwfQYi.js";const Re=["/","/intro.html","/Game/GameofLife.html","/Game/Langtonsant.html","/Game/wordle.html","/other/cc.html","/other/friends.html","/other/githubpulls.html","/other/issues.html","/tools/ipcheck.html","/posts/NekoXii/Crazy.html","/posts/daily/Destiny%20Year7.html","/posts/daily/GTNH.html","/posts/daily/Gitlab%20Pollution.html","/posts/daily/HuoShen80Hub.html","/posts/daily/OpenBmclapi.html","/posts/daily/PWA.html","/posts/daily/WordPress%20to%20VuePress.html","/posts/develop/1Panel%20Redis%20Object%20Cache.html","/posts/develop/Blog%20Architecture.html","/posts/develop/Enabling%20the%20xterm.js%20console%20for%20OpenSuse%20in%20PVE%20.html","/posts/develop/Manual%20merge%20Pull%20requests.html","/posts/develop/OpenMCIM.html","/posts/develop/Public%20DNS%20DOH.html","/posts/develop/Remove%20Pve%20No%20valid%20subscription.html","/posts/develop/icon.html","/posts/develop/randomimage.html","/404.html","/Game/","/other/","/tools/","/posts/NekoXii/","/posts/","/posts/daily/","/posts/develop/","/category/","/category/nekoxii/","/category/daily/","/category/develop/","/tag/","/tag/nekoxii/","/tag/crazy/","/tag/%E5%91%BD%E8%BF%902/","/tag/%E6%97%A5%E5%B8%B8/","/tag/gtnh/","/tag/%E7%81%AB%E7%A5%9E/","/tag/pwa/","/tag/wordpress/","/tag/1panel/","/tag/%E5%8D%9A%E5%AE%A2%E5%BC%80%E5%8F%91/","/tag/pve/","/tag/opensuse/","/tag/git/","/tag/mc/","/tag/%E6%9C%8D%E5%8A%A1/","/tag/dns/","/tag/fontawesome/","/tag/%E9%9A%8F%E6%9C%BA%E5%9B%BE%E7%89%87/","/article/","/star/","/timeline/"],we="SLIMSEARCH_QUERY_HISTORY",y=j(we,[]),Ae=()=>{const{queryHistoryCount:l}=A,a=l>0;return{enabled:a,queryHistories:y,addQueryHistory:i=>{a&&(y.value=Array.from(new Set([i,...y.value.slice(0,l-1)])))},removeQueryHistory:i=>{y.value=[...y.value.slice(0,i),...y.value.slice(i+1)]}}},B=l=>Re[l.id]+("anchor"in l?`#${l.anchor}`:""),Ce="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:M}=A,g=j(Ce,[]),xe=()=>{const l=M>0;return{enabled:l,resultHistories:g,addResultHistory:a=>{if(l){const i={link:B(a),display:a.display};"header"in a&&(i.header=a.header),g.value=[i,...g.value.slice(0,M-1)]}},removeResultHistory:a=>{g.value=[...g.value.slice(0,a),...g.value.slice(a+1)]}}},Se=l=>{const a=he(),i=I(),C=me(),u=L(0),E=w(()=>u.value>0),p=pe([]);return de(()=>{const{search:d,terminate:x}=ye(),f=ge(n=>{const{resultsFilter:H=o=>o,querySplitter:P,suggestionsFilter:S,...Q}=a.value;n?(u.value+=1,d(n,i.value,Q).then(o=>H(o,n,i.value,C.value)).then(o=>{u.value-=1,p.value=o}).catch(o=>{console.warn(o),u.value-=1,u.value||(p.value=[])})):p.value=[]},A.searchDelay-A.suggestDelay,{maxWait:5e3});N([l,i],([n])=>{f(n.join(" "))},{immediate:!0}),fe(()=>{x()})}),{isSearching:E,results:p}};var qe=se({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(l,{emit:a}){const i=te(),C=I(),u=le(ae),{enabled:E,addQueryHistory:p,queryHistories:d,removeQueryHistory:x}=Ae(),{enabled:f,resultHistories:n,addResultHistory:H,removeResultHistory:P}=xe(),S=E||f,Q=ie(l,"queries"),{results:o,isSearching:U}=Se(Q),r=re({isQuery:!0,index:0}),h=L(0),m=L(0),F=w(()=>S&&(d.value.length>0||n.value.length>0)),q=w(()=>o.value.length>0),D=w(()=>o.value[h.value]||null),Y=()=>{const{isQuery:e,index:s}=r;s===0?(r.isQuery=!e,r.index=e?n.value.length-1:d.value.length-1):r.index=s-1},z=()=>{const{isQuery:e,index:s}=r;s===(e?d.value.length-1:n.value.length-1)?(r.isQuery=!e,r.index=0):r.index=s+1},V=()=>{h.value=h.value>0?h.value-1:o.value.length-1,m.value=D.value.contents.length-1},W=()=>{h.value=h.value<o.value.length-1?h.value+1:0,m.value=0},_=()=>{m.value<D.value.contents.length-1?m.value+=1:W()},X=()=>{m.value>0?m.value-=1:V()},b=e=>e.map(s=>ke(s)?s:t(s[0],s[1])),J=e=>{if(e.type==="customField"){const s=Ee[e.index]||"$content",[c,R=""]=He(s)?s[C.value].split("$content"):s.split("$content");return e.display.map(v=>t("div",b([c,...v,R])))}return e.display.map(s=>t("div",b(s)))},k=()=>{h.value=0,m.value=0,a("updateQuery",""),a("close")},K=()=>E?t("ul",{class:"slimsearch-result-list"},t("li",{class:"slimsearch-result-list-item"},[t("div",{class:"slimsearch-result-title"},u.value.queryHistory),d.value.map((e,s)=>t("div",{class:["slimsearch-result-item",{active:r.isQuery&&r.index===s}],onClick:()=>{a("updateQuery",e)}},[t(T,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},e),t("button",{class:"slimsearch-remove-icon",innerHTML:G,onClick:c=>{c.preventDefault(),c.stopPropagation(),x(s)}})]))])):null,Z=()=>f?t("ul",{class:"slimsearch-result-list"},t("li",{class:"slimsearch-result-list-item"},[t("div",{class:"slimsearch-result-title"},u.value.resultHistory),n.value.map((e,s)=>t(O,{to:e.link,class:["slimsearch-result-item",{active:!r.isQuery&&r.index===s}],onClick:()=>{k()}},()=>[t(T,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},[e.header?t("div",{class:"content-header"},e.header):null,t("div",e.display.map(c=>b(c)).flat())]),t("button",{class:"slimsearch-remove-icon",innerHTML:G,onClick:c=>{c.preventDefault(),c.stopPropagation(),P(s)}})]))])):null;return ue("keydown",e=>{if(l.isFocusing){if(q.value){if(e.key==="ArrowUp")X();else if(e.key==="ArrowDown")_();else if(e.key==="Enter"){const s=D.value.contents[m.value];p(l.queries.join(" ")),H(s),i.push(B(s)),k()}}else if(f){if(e.key==="ArrowUp")Y();else if(e.key==="ArrowDown")z();else if(e.key==="Enter"){const{index:s}=r;r.isQuery?(a("updateQuery",d.value[s]),e.preventDefault()):(i.push(n.value[s].link),k())}}}}),N([h,m],()=>{var e;(e=document.querySelector(".slimsearch-result-list-item.active .slimsearch-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>t("div",{class:["slimsearch-result-wrapper",{empty:l.queries.length?!q.value:!F.value}],id:"slimsearch-results"},l.queries.length?U.value?t(oe,{hint:u.value.searching}):q.value?t("ul",{class:"slimsearch-result-list"},o.value.map(({title:e,contents:s},c)=>{const R=h.value===c;return t("li",{class:["slimsearch-result-list-item",{active:R}]},[t("div",{class:"slimsearch-result-title"},e||u.value.defaultTitle),s.map((v,ee)=>{const $=R&&m.value===ee;return t(O,{to:B(v),class:["slimsearch-result-item",{active:$,"aria-selected":$}],onClick:()=>{p(l.queries.join(" ")),H(v),k()}},()=>[v.type==="text"?null:t(v.type==="title"?ne:v.type==="heading"?ce:ve,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},[v.type==="text"&&v.header?t("div",{class:"content-header"},v.header):null,t("div",J(v))])])})])})):u.value.emptyResult:S?F.value?[K(),Z()]:u.value.emptyHistory:u.value.emptyResult)}});export{qe as default};
